- name: Add user "pinger"
  user:
    name: pinger

- name: Install Fping
  apt:
    name: fping
    state: latest

- name: Create install directory
  file:
    path: /etc/pinger
    state: directory
    mode: '0755'

- name: Create install directory
  file:
    state: directory
    path: /usr/local/bin/pinger
    owner: pinger
    mode: '0755'

- name: Place the .sh file where it needs to be
  template:
    src: pinger.sh
    dest: /usr/local/bin/pinger/pinger.sh
    mode: '0777'

- name: Create a service called pinger
  template:
    src: pinger.service
    dest: /etc/systemd/system/pinger.service
  notify:
    - Reload Daemon
    - Restart pinger

- name: Put the config file in place
  template:
    src: pinger.conf
    dest: /etc/pinger/pinger.conf

- name: collect facts about system services
  service_facts:

- name: Sleep for 10 seconds and continue with play
  wait_for:
    timeout: 10
  changed_when: ansible_facts.services['pinger.service'].state != "running"
  notify: Restart pinger

